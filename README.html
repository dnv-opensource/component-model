<!doctype html>
<html class="no-js" lang="en" data-content_root="./">
  <head><meta charset="utf-8"/>
    <meta name="viewport" content="width=device-width,initial-scale=1"/>
    <meta name="color-scheme" content="light dark"><meta name="viewport" content="width=device-width, initial-scale=1" />
<link rel="index" title="Index" href="genindex.html" /><link rel="search" title="Search" href="search.html" /><link rel="next" title="Changelog" href="CHANGELOG.html" /><link rel="prev" title="component-model: Python Package to create Component Models" href="index.html" />

    <!-- Generated with Sphinx 8.1.3 and Furo 2024.08.06 -->
        <title>Introduction - component-model 0.1.0</title>
      <link rel="stylesheet" type="text/css" href="_static/pygments.css?v=a746c00c" />
    <link rel="stylesheet" type="text/css" href="_static/styles/furo.css?v=354aac6f" />
    <link rel="stylesheet" type="text/css" href="_static/custom.css" />
    <link rel="stylesheet" type="text/css" href="_static/graphviz.css?v=4ae1632d" />
    <link rel="stylesheet" type="text/css" href="_static/styles/furo-extensions.css?v=302659d7" />
    
    


<style>
  body {
    --color-code-background: #f8f8f8;
  --color-code-foreground: black;
  
  }
  @media not print {
    body[data-theme="dark"] {
      --color-code-background: #202020;
  --color-code-foreground: #d0d0d0;
  
    }
    @media (prefers-color-scheme: dark) {
      body:not([data-theme="light"]) {
        --color-code-background: #202020;
  --color-code-foreground: #d0d0d0;
  
      }
    }
  }
</style></head>
  <body>
    
    <script>
      document.body.dataset.theme = localStorage.getItem("theme") || "auto";
    </script>
    

<svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
  <symbol id="svg-toc" viewBox="0 0 24 24">
    <title>Contents</title>
    <svg stroke="currentColor" fill="currentColor" stroke-width="0" viewBox="0 0 1024 1024">
      <path d="M408 442h480c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8H408c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8zm-8 204c0 4.4 3.6 8 8 8h480c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8H408c-4.4 0-8 3.6-8 8v56zm504-486H120c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8h784c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8zm0 632H120c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8h784c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8zM115.4 518.9L271.7 642c5.8 4.6 14.4.5 14.4-6.9V388.9c0-7.4-8.5-11.5-14.4-6.9L115.4 505.1a8.74 8.74 0 0 0 0 13.8z"/>
    </svg>
  </symbol>
  <symbol id="svg-menu" viewBox="0 0 24 24">
    <title>Menu</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather-menu">
      <line x1="3" y1="12" x2="21" y2="12"></line>
      <line x1="3" y1="6" x2="21" y2="6"></line>
      <line x1="3" y1="18" x2="21" y2="18"></line>
    </svg>
  </symbol>
  <symbol id="svg-arrow-right" viewBox="0 0 24 24">
    <title>Expand</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather-chevron-right">
      <polyline points="9 18 15 12 9 6"></polyline>
    </svg>
  </symbol>
  <symbol id="svg-sun" viewBox="0 0 24 24">
    <title>Light mode</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1" stroke-linecap="round" stroke-linejoin="round" class="feather-sun">
      <circle cx="12" cy="12" r="5"></circle>
      <line x1="12" y1="1" x2="12" y2="3"></line>
      <line x1="12" y1="21" x2="12" y2="23"></line>
      <line x1="4.22" y1="4.22" x2="5.64" y2="5.64"></line>
      <line x1="18.36" y1="18.36" x2="19.78" y2="19.78"></line>
      <line x1="1" y1="12" x2="3" y2="12"></line>
      <line x1="21" y1="12" x2="23" y2="12"></line>
      <line x1="4.22" y1="19.78" x2="5.64" y2="18.36"></line>
      <line x1="18.36" y1="5.64" x2="19.78" y2="4.22"></line>
    </svg>
  </symbol>
  <symbol id="svg-moon" viewBox="0 0 24 24">
    <title>Dark mode</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1" stroke-linecap="round" stroke-linejoin="round" class="icon-tabler-moon">
      <path stroke="none" d="M0 0h24v24H0z" fill="none" />
      <path d="M12 3c.132 0 .263 0 .393 0a7.5 7.5 0 0 0 7.92 12.446a9 9 0 1 1 -8.313 -12.454z" />
    </svg>
  </symbol>
  <symbol id="svg-sun-with-moon" viewBox="0 0 24 24">
    <title>Auto light/dark, in light mode</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1" stroke-linecap="round" stroke-linejoin="round"
      class="icon-custom-derived-from-feather-sun-and-tabler-moon">
      <path style="opacity: 50%" d="M 5.411 14.504 C 5.471 14.504 5.532 14.504 5.591 14.504 C 3.639 16.319 4.383 19.569 6.931 20.352 C 7.693 20.586 8.512 20.551 9.25 20.252 C 8.023 23.207 4.056 23.725 2.11 21.184 C 0.166 18.642 1.702 14.949 4.874 14.536 C 5.051 14.512 5.231 14.5 5.411 14.5 L 5.411 14.504 Z"/>
      <line x1="14.5" y1="3.25" x2="14.5" y2="1.25"/>
      <line x1="14.5" y1="15.85" x2="14.5" y2="17.85"/>
      <line x1="10.044" y1="5.094" x2="8.63" y2="3.68"/>
      <line x1="19" y1="14.05" x2="20.414" y2="15.464"/>
      <line x1="8.2" y1="9.55" x2="6.2" y2="9.55"/>
      <line x1="20.8" y1="9.55" x2="22.8" y2="9.55"/>
      <line x1="10.044" y1="14.006" x2="8.63" y2="15.42"/>
      <line x1="19" y1="5.05" x2="20.414" y2="3.636"/>
      <circle cx="14.5" cy="9.55" r="3.6"/>
    </svg>
  </symbol>
  <symbol id="svg-moon-with-sun" viewBox="0 0 24 24">
    <title>Auto light/dark, in dark mode</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1" stroke-linecap="round" stroke-linejoin="round"
      class="icon-custom-derived-from-feather-sun-and-tabler-moon">
      <path d="M 8.282 7.007 C 8.385 7.007 8.494 7.007 8.595 7.007 C 5.18 10.184 6.481 15.869 10.942 17.24 C 12.275 17.648 13.706 17.589 15 17.066 C 12.851 22.236 5.91 23.143 2.505 18.696 C -0.897 14.249 1.791 7.786 7.342 7.063 C 7.652 7.021 7.965 7 8.282 7 L 8.282 7.007 Z"/>
      <line style="opacity: 50%" x1="18" y1="3.705" x2="18" y2="2.5"/>
      <line style="opacity: 50%" x1="18" y1="11.295" x2="18" y2="12.5"/>
      <line style="opacity: 50%" x1="15.316" y1="4.816" x2="14.464" y2="3.964"/>
      <line style="opacity: 50%" x1="20.711" y1="10.212" x2="21.563" y2="11.063"/>
      <line style="opacity: 50%" x1="14.205" y1="7.5" x2="13.001" y2="7.5"/>
      <line style="opacity: 50%" x1="21.795" y1="7.5" x2="23" y2="7.5"/>
      <line style="opacity: 50%" x1="15.316" y1="10.184" x2="14.464" y2="11.036"/>
      <line style="opacity: 50%" x1="20.711" y1="4.789" x2="21.563" y2="3.937"/>
      <circle style="opacity: 50%" cx="18" cy="7.5" r="2.169"/>
    </svg>
  </symbol>
  <symbol id="svg-pencil" viewBox="0 0 24 24">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1" stroke-linecap="round" stroke-linejoin="round" class="icon-tabler-pencil-code">
      <path d="M4 20h4l10.5 -10.5a2.828 2.828 0 1 0 -4 -4l-10.5 10.5v4" />
      <path d="M13.5 6.5l4 4" />
      <path d="M20 21l2 -2l-2 -2" />
      <path d="M17 17l-2 2l2 2" />
    </svg>
  </symbol>
  <symbol id="svg-eye" viewBox="0 0 24 24">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1" stroke-linecap="round" stroke-linejoin="round" class="icon-tabler-eye-code">
      <path stroke="none" d="M0 0h24v24H0z" fill="none" />
      <path d="M10 12a2 2 0 1 0 4 0a2 2 0 0 0 -4 0" />
      <path
        d="M11.11 17.958c-3.209 -.307 -5.91 -2.293 -8.11 -5.958c2.4 -4 5.4 -6 9 -6c3.6 0 6.6 2 9 6c-.21 .352 -.427 .688 -.647 1.008" />
      <path d="M20 21l2 -2l-2 -2" />
      <path d="M17 17l-2 2l2 2" />
    </svg>
  </symbol>
</svg>

<input type="checkbox" class="sidebar-toggle" name="__navigation" id="__navigation">
<input type="checkbox" class="sidebar-toggle" name="__toc" id="__toc">
<label class="overlay sidebar-overlay" for="__navigation">
  <div class="visually-hidden">Hide navigation sidebar</div>
</label>
<label class="overlay toc-overlay" for="__toc">
  <div class="visually-hidden">Hide table of contents sidebar</div>
</label>

<a class="skip-to-content muted-link" href="#furo-main-content">Skip to content</a>



<div class="page">
  <header class="mobile-header">
    <div class="header-left">
      <label class="nav-overlay-icon" for="__navigation">
        <div class="visually-hidden">Toggle site navigation sidebar</div>
        <i class="icon"><svg><use href="#svg-menu"></use></svg></i>
      </label>
    </div>
    <div class="header-center">
      <a href="index.html"><div class="brand">component-model 0.1.0</div></a>
    </div>
    <div class="header-right">
      <div class="theme-toggle-container theme-toggle-header">
        <button class="theme-toggle">
          <div class="visually-hidden">Toggle Light / Dark / Auto color theme</div>
          <svg class="theme-icon-when-auto-light"><use href="#svg-sun-with-moon"></use></svg>
          <svg class="theme-icon-when-auto-dark"><use href="#svg-moon-with-sun"></use></svg>
          <svg class="theme-icon-when-dark"><use href="#svg-moon"></use></svg>
          <svg class="theme-icon-when-light"><use href="#svg-sun"></use></svg>
        </button>
      </div>
      <label class="toc-overlay-icon toc-header-icon" for="__toc">
        <div class="visually-hidden">Toggle table of contents sidebar</div>
        <i class="icon"><svg><use href="#svg-toc"></use></svg></i>
      </label>
    </div>
  </header>
  <aside class="sidebar-drawer">
    <div class="sidebar-container">
      
      <div class="sidebar-sticky"><a class="sidebar-brand" href="index.html">
  
  <div class="sidebar-logo-container">
    <img class="sidebar-logo" src="_static/component-model.svg" alt="Logo"/>
  </div>
  
  <span class="sidebar-brand-text">component-model 0.1.0</span>
  
</a><form class="sidebar-search-container" method="get" action="search.html" role="search">
  <input class="sidebar-search" placeholder="Search" name="q" aria-label="Search">
  <input type="hidden" name="check_keywords" value="yes">
  <input type="hidden" name="area" value="default">
</form>
<div id="searchbox"></div><div class="sidebar-scroll"><div class="sidebar-tree">
  <p class="caption" role="heading"><span class="caption-text">Contents:</span></p>
<ul class="current">
<li class="toctree-l1 current current-page"><a class="current reference internal" href="#">Introduction</a></li>
<li class="toctree-l1"><a class="reference internal" href="CHANGELOG.html">Changelog</a></li>
<li class="toctree-l1"><a class="reference internal" href="LICENSE.html">LICENSE</a></li>
<li class="toctree-l1 has-children"><a class="reference internal" href="api.html">API Reference</a><input class="toctree-checkbox" id="toctree-checkbox-1" name="toctree-checkbox-1" role="switch" type="checkbox"/><label for="toctree-checkbox-1"><div class="visually-hidden">Toggle navigation of API Reference</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l2 has-children"><a class="reference internal" href="_autosummary/component_model.model.html">component_model.model</a><input class="toctree-checkbox" id="toctree-checkbox-2" name="toctree-checkbox-2" role="switch" type="checkbox"/><label for="toctree-checkbox-2"><div class="visually-hidden">Toggle navigation of component_model.model</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l3"><a class="reference internal" href="_autosummary/component_model.model.Model.html">Model</a></li>
</ul>
</li>
<li class="toctree-l2 has-children"><a class="reference internal" href="_autosummary/component_model.variable.html">component_model.variable</a><input class="toctree-checkbox" id="toctree-checkbox-3" name="toctree-checkbox-3" role="switch" type="checkbox"/><label for="toctree-checkbox-3"><div class="visually-hidden">Toggle navigation of component_model.variable</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l3"><a class="reference internal" href="_autosummary/component_model.variable.Check.html">Check</a></li>
<li class="toctree-l3"><a class="reference internal" href="_autosummary/component_model.variable.Variable.html">Variable</a></li>
</ul>
</li>
<li class="toctree-l2 has-children"><a class="reference internal" href="_autosummary/component_model.utils.html">component_model.utils</a><input class="toctree-checkbox" id="toctree-checkbox-4" name="toctree-checkbox-4" role="switch" type="checkbox"/><label for="toctree-checkbox-4"><div class="visually-hidden">Toggle navigation of component_model.utils</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l3"><a class="reference internal" href="_autosummary/component_model.utils.fmu.html">component_model.utils.fmu</a></li>
<li class="toctree-l3 has-children"><a class="reference internal" href="_autosummary/component_model.utils.logger.html">component_model.utils.logger</a><input class="toctree-checkbox" id="toctree-checkbox-5" name="toctree-checkbox-5" role="switch" type="checkbox"/><label for="toctree-checkbox-5"><div class="visually-hidden">Toggle navigation of component_model.utils.logger</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l4"><a class="reference internal" href="_autosummary/component_model.utils.logger.MsgCounterHandler.html">MsgCounterHandler</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="_autosummary/component_model.utils.logging.html">component_model.utils.logging</a></li>
<li class="toctree-l3"><a class="reference internal" href="_autosummary/component_model.utils.osp.html">component_model.utils.osp</a></li>
<li class="toctree-l3"><a class="reference internal" href="_autosummary/component_model.utils.xml.html">component_model.utils.xml</a></li>
</ul>
</li>
</ul>
</li>
</ul>

</div>
</div>

      </div>
      
    </div>
  </aside>
  <div class="main">
    <div class="content">
      <div class="article-container">
        <a href="#" class="back-to-top muted-link">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
            <path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8v12z"></path>
          </svg>
          <span>Back to top</span>
        </a>
        <div class="content-icon-container">
          <div class="view-this-page">
  <a class="muted-link" href="_sources/README.rst.txt" title="View this page">
    <svg><use href="#svg-eye"></use></svg>
    <span class="visually-hidden">View this page</span>
  </a>
</div>
<div class="theme-toggle-container theme-toggle-content">
            <button class="theme-toggle">
              <div class="visually-hidden">Toggle Light / Dark / Auto color theme</div>
              <svg class="theme-icon-when-auto-light"><use href="#svg-sun-with-moon"></use></svg>
              <svg class="theme-icon-when-auto-dark"><use href="#svg-moon-with-sun"></use></svg>
              <svg class="theme-icon-when-dark"><use href="#svg-moon"></use></svg>
              <svg class="theme-icon-when-light"><use href="#svg-sun"></use></svg>
            </button>
          </div>
          <label class="toc-overlay-icon toc-content-icon" for="__toc">
            <div class="visually-hidden">Toggle table of contents sidebar</div>
            <i class="icon"><svg><use href="#svg-toc"></use></svg></i>
          </label>
        </div>
        <article role="main" id="furo-main-content">
          <section id="introduction">
<h1>Introduction<a class="headerlink" href="#introduction" title="Link to this heading">¶</a></h1>
<p>The package extends the <a class="reference external" href="https://github.com/NTNU-IHB/PythonFMU">PythonFMU package</a>.
It includes the necessary modules to construct a component model according to the fmi, OSP and DNV-RP-0513 standards
with focus on the following features:</p>
<ul class="simple">
<li><p>seamless translation of a Python model to an FMU package with minimal overhead (definition of FMU interface)</p></li>
<li><p>support of vector variables (numpy)</p></li>
<li><p>support of variable units and display units</p></li>
<li><p>support of range checking of variables</p></li>
</ul>
<p>Features which facilitate <a class="reference external" href="https://standards.dnv.com/explorer/document/6A4F5922251B496B9216572C23730D33/2">Assurance of Simulation Models, DNV-RP-0513</a>
shall have a special focus in this package.</p>
<section id="installation">
<h2>Installation<a class="headerlink" href="#installation" title="Link to this heading">¶</a></h2>
<p><code class="docutils literal notranslate"><span class="pre">pip</span> <span class="pre">install</span> <span class="pre">component-model</span></code></p>
</section>
<section id="getting-started">
<h2>Getting Started<a class="headerlink" href="#getting-started" title="Link to this heading">¶</a></h2>
<p>A new model can consist of any python code. To turn the python code into an FMU the following is necessary</p>
<ol class="arabic simple">
<li><p>The model code is wrapped into a Python class which inherits from <cite>Model</cite></p></li>
<li><p>The exposed interface variables (model parameters, input- and output connectors) are defined as <cite>Variable</cite> objects</p></li>
<li><p>The <cite>(model).do_step( time, dt)</cite> function of the model class is extended with model internal code,
i.e. model evolves from <cite>time</cite> to <cite>time+dt</cite>.</p></li>
<li><p>Calling the method <cite>Model.build()</cite> will then compile the FMU and package it into a suitable FMU file.</p></li>
</ol>
<p>See the files <cite>example_models/bouncing_ball.py</cite> and <cite>tests/test_make_bouncingBall.py</cite> supplied with this package
as a simple example of this process. The first file defines the model class
and the second file demonstrates the process of making the FMU and using it within fmpy and OSP.</p>
</section>
<section id="usage-example">
<h2>Usage example<a class="headerlink" href="#usage-example" title="Link to this heading">¶</a></h2>
<p>This is another BouncingBall example, using 3D vectors and units.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">math</span> <span class="kn">import</span> <span class="n">sqrt</span>

<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>

<span class="kn">from</span> <span class="nn">component_model.model</span> <span class="kn">import</span> <span class="n">Model</span>
<span class="kn">from</span> <span class="nn">component_model.variable</span> <span class="kn">import</span> <span class="n">Variable</span>


<span class="k">class</span> <span class="nc">BouncingBall3D</span><span class="p">(</span><span class="n">Model</span><span class="p">):</span>
<span class="w">   </span><span class="sd">&quot;&quot;&quot;Another Python-based BouncingBall model, using PythonFMU to construct a FMU.</span>

<span class="sd">   Special features:</span>

<span class="sd">   * The ball has a 3-D vector as position and speed</span>
<span class="sd">   * As output variable the model estimates the next bouncing point</span>
<span class="sd">   * As input variables, the restitution coefficient `e`, the gravitational acceleration `g`</span>
<span class="sd">      and the initial speed can be changed.</span>
<span class="sd">   * Internal units are SI (m,s,rad)</span>

<span class="sd">   Args:</span>
<span class="sd">      pos (np.array)=(0,0,1): The 3-D position in of the ball at time [m]</span>
<span class="sd">      speed (np.array)=(1,0,0): The 3-D speed of the ball at time [m/s]</span>
<span class="sd">      g (float)=9.81: The gravitational acceleration [m/s^2]</span>
<span class="sd">      e (float)=0.9: The coefficient of restitution (dimensionless): |speed after| / |speed before| collision</span>
<span class="sd">      min_speed_z (float)=1e-6: The minimum speed in z-direction when bouncing stops [m/s]</span>
<span class="sd">   &quot;&quot;&quot;</span>

   <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span>
      <span class="bp">self</span><span class="p">,</span>
      <span class="n">name</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;BouncingBall3D&quot;</span><span class="p">,</span>
      <span class="n">description</span><span class="o">=</span><span class="s2">&quot;Another Python-based BouncingBall model, using Model and Variable to construct a FMU&quot;</span><span class="p">,</span>
      <span class="n">pos</span><span class="p">:</span> <span class="nb">tuple</span> <span class="o">=</span> <span class="p">(</span><span class="s2">&quot;0 m&quot;</span><span class="p">,</span> <span class="s2">&quot;0 m&quot;</span><span class="p">,</span> <span class="s2">&quot;10 inch&quot;</span><span class="p">),</span>
      <span class="n">speed</span><span class="p">:</span> <span class="nb">tuple</span> <span class="o">=</span> <span class="p">(</span><span class="s2">&quot;1 m/s&quot;</span><span class="p">,</span> <span class="s2">&quot;0 m/s&quot;</span><span class="p">,</span> <span class="s2">&quot;0 m/s&quot;</span><span class="p">),</span>
      <span class="n">g</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="s2">&quot;9.81 m/s^2&quot;</span><span class="p">,</span>
      <span class="n">e</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">0.9</span><span class="p">,</span>
      <span class="n">min_speed_z</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">1e-6</span><span class="p">,</span>
      <span class="o">**</span><span class="n">kwargs</span><span class="p">,</span>
   <span class="p">):</span>
      <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">description</span><span class="p">,</span> <span class="n">author</span><span class="o">=</span><span class="s2">&quot;DNV, SEACo project&quot;</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
      <span class="bp">self</span><span class="o">.</span><span class="n">_pos</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_interface</span><span class="p">(</span><span class="s2">&quot;pos&quot;</span><span class="p">,</span> <span class="n">pos</span><span class="p">)</span>
      <span class="bp">self</span><span class="o">.</span><span class="n">_speed</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_interface</span><span class="p">(</span><span class="s2">&quot;speed&quot;</span><span class="p">,</span> <span class="n">speed</span><span class="p">)</span>
      <span class="bp">self</span><span class="o">.</span><span class="n">_g</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_interface</span><span class="p">(</span><span class="s2">&quot;g&quot;</span><span class="p">,</span> <span class="n">g</span><span class="p">)</span>
      <span class="bp">self</span><span class="o">.</span><span class="n">a</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">((</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="o">-</span><span class="bp">self</span><span class="o">.</span><span class="n">g</span><span class="p">),</span> <span class="nb">float</span><span class="p">)</span>
      <span class="bp">self</span><span class="o">.</span><span class="n">_e</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_interface</span><span class="p">(</span><span class="s2">&quot;e&quot;</span><span class="p">,</span> <span class="n">e</span><span class="p">)</span>
      <span class="bp">self</span><span class="o">.</span><span class="n">min_speed_z</span> <span class="o">=</span> <span class="n">min_speed_z</span>
      <span class="bp">self</span><span class="o">.</span><span class="n">stopped</span> <span class="o">=</span> <span class="kc">False</span>
      <span class="bp">self</span><span class="o">.</span><span class="n">time</span> <span class="o">=</span> <span class="mf">0.0</span>
      <span class="bp">self</span><span class="o">.</span><span class="n">_p_bounce</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_interface</span><span class="p">(</span><span class="s2">&quot;p_bounce&quot;</span><span class="p">,</span> <span class="p">(</span><span class="s2">&quot;0m&quot;</span><span class="p">,</span> <span class="s2">&quot;0m&quot;</span><span class="p">,</span> <span class="s2">&quot;0m&quot;</span><span class="p">))</span>  <span class="c1"># Note: 3D, but z always 0</span>
      <span class="bp">self</span><span class="o">.</span><span class="n">t_bounce</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">p_bounce</span> <span class="o">=</span> <span class="p">(</span><span class="o">-</span><span class="mf">1.0</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">pos</span><span class="p">)</span>  <span class="c1"># provoke an update at simulation start</span>

   <span class="k">def</span> <span class="nf">do_step</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">_</span><span class="p">,</span> <span class="n">dt</span><span class="p">):</span>
<span class="w">      </span><span class="sd">&quot;&quot;&quot;Perform a simulation step from `self.time` to `self.time + dt`.</span>

<span class="sd">      With respect to bouncing (self.t_bounce should be initialized to a negative value)</span>
<span class="sd">      .t_bounce &lt;= .time: update .t_bounce</span>
<span class="sd">      .time &lt; .t_bounce &lt;= .time+dt: bouncing happens within time step</span>
<span class="sd">      .t_bounce &gt; .time+dt: no bouncing. Just advance .pos and .speed</span>
<span class="sd">      &quot;&quot;&quot;</span>
      <span class="k">if</span> <span class="ow">not</span> <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">do_step</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">time</span><span class="p">,</span> <span class="n">dt</span><span class="p">):</span>
            <span class="k">return</span> <span class="kc">False</span>
      <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">t_bounce</span> <span class="o">&lt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">time</span><span class="p">:</span>  <span class="c1"># calculate first bounce</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">t_bounce</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">p_bounce</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">next_bounce</span><span class="p">()</span>
      <span class="k">while</span> <span class="bp">self</span><span class="o">.</span><span class="n">t_bounce</span> <span class="o">&lt;=</span> <span class="bp">self</span><span class="o">.</span><span class="n">time</span> <span class="o">+</span> <span class="n">dt</span><span class="p">:</span>  <span class="c1"># bounce happens within step or at border</span>
            <span class="n">dt1</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">t_bounce</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">time</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">pos</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">p_bounce</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">speed</span> <span class="o">+=</span> <span class="bp">self</span><span class="o">.</span><span class="n">a</span> <span class="o">*</span> <span class="n">dt1</span>  <span class="c1"># speed before bouncing</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">speed</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="o">-</span><span class="bp">self</span><span class="o">.</span><span class="n">speed</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span>  <span class="c1"># speed after bouncing if e==1.0</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">speed</span> <span class="o">*=</span> <span class="bp">self</span><span class="o">.</span><span class="n">e</span>  <span class="c1"># speed reduction due to coefficient of restitution</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">speed</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">&lt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">min_speed_z</span><span class="p">:</span>
               <span class="bp">self</span><span class="o">.</span><span class="n">stopped</span> <span class="o">=</span> <span class="kc">True</span>
               <span class="bp">self</span><span class="o">.</span><span class="n">a</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.0</span>
               <span class="bp">self</span><span class="o">.</span><span class="n">speed</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.0</span>
               <span class="bp">self</span><span class="o">.</span><span class="n">pos</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.0</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">time</span> <span class="o">+=</span> <span class="n">dt1</span>  <span class="c1"># jump to the exact bounce time</span>
            <span class="n">dt</span> <span class="o">-=</span> <span class="n">dt1</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">t_bounce</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">p_bounce</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">next_bounce</span><span class="p">()</span>  <span class="c1"># update to the next bounce</span>
      <span class="k">if</span> <span class="n">dt</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="c1"># print(f&quot;pos={self.pos}, speed={self.speed}, a={self.a}, dt={dt}&quot;)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">pos</span> <span class="o">+=</span> <span class="bp">self</span><span class="o">.</span><span class="n">speed</span> <span class="o">*</span> <span class="n">dt</span> <span class="o">+</span> <span class="mf">0.5</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">a</span> <span class="o">*</span> <span class="n">dt</span><span class="o">**</span><span class="mi">2</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">speed</span> <span class="o">+=</span> <span class="bp">self</span><span class="o">.</span><span class="n">a</span> <span class="o">*</span> <span class="n">dt</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">time</span> <span class="o">+=</span> <span class="n">dt</span>
      <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">pos</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">pos</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>
      <span class="k">return</span> <span class="kc">True</span>

   <span class="k">def</span> <span class="nf">next_bounce</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">      </span><span class="sd">&quot;&quot;&quot;Calculate time of next bounce and position where the ground will be hit,</span>
<span class="sd">      based on .time, .pos and .speed.</span>
<span class="sd">      &quot;&quot;&quot;</span>
      <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">stopped</span><span class="p">:</span>  <span class="c1"># stopped bouncing</span>
            <span class="k">return</span> <span class="p">(</span><span class="mf">1e300</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">((</span><span class="mf">1e300</span><span class="p">,</span> <span class="mf">1e300</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span> <span class="nb">float</span><span class="p">))</span>
      <span class="k">else</span><span class="p">:</span>
            <span class="n">dt_bounce</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">speed</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">+</span> <span class="n">sqrt</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">speed</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">**</span> <span class="mi">2</span> <span class="o">+</span> <span class="mi">2</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">g</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">pos</span><span class="p">[</span><span class="mi">2</span><span class="p">]))</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">g</span>
            <span class="n">p_bounce</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">pos</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">speed</span> <span class="o">*</span> <span class="n">dt_bounce</span>  <span class="c1"># linear. not correct for z-direction!</span>
            <span class="n">p_bounce</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>
            <span class="k">return</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">time</span> <span class="o">+</span> <span class="n">dt_bounce</span><span class="p">,</span> <span class="n">p_bounce</span><span class="p">)</span>

   <span class="k">def</span> <span class="nf">setup_experiment</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">start</span><span class="p">:</span> <span class="nb">float</span><span class="p">):</span>
<span class="w">      </span><span class="sd">&quot;&quot;&quot;Set initial (non-interface) variables.&quot;&quot;&quot;</span>
      <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">setup_experiment</span><span class="p">(</span><span class="n">start</span><span class="p">)</span>
      <span class="bp">self</span><span class="o">.</span><span class="n">stopped</span> <span class="o">=</span> <span class="kc">False</span>
      <span class="bp">self</span><span class="o">.</span><span class="n">time</span> <span class="o">=</span> <span class="n">start</span>

   <span class="k">def</span> <span class="nf">exit_initialization_mode</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">      </span><span class="sd">&quot;&quot;&quot;Initialize the model after initial variables are set.&quot;&quot;&quot;</span>
      <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">exit_initialization_mode</span><span class="p">()</span>
      <span class="bp">self</span><span class="o">.</span><span class="n">a</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">((</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="o">-</span><span class="bp">self</span><span class="o">.</span><span class="n">g</span><span class="p">),</span> <span class="nb">float</span><span class="p">)</span>

   <span class="k">def</span> <span class="nf">_interface</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">start</span><span class="p">:</span> <span class="nb">float</span> <span class="o">|</span> <span class="nb">tuple</span><span class="p">):</span>
<span class="w">      </span><span class="sd">&quot;&quot;&quot;Define a FMU2 interface variable, using the variable interface.</span>

<span class="sd">      Args:</span>
<span class="sd">            name (str): base name of the variable</span>
<span class="sd">            start (str|float|tuple): start value of the variable (optionally with units)</span>

<span class="sd">      Returns:</span>
<span class="sd">            the variable object. As a side effect the variable value is made available as self.&lt;name&gt;</span>
<span class="sd">      &quot;&quot;&quot;</span>
      <span class="k">if</span> <span class="n">name</span> <span class="o">==</span> <span class="s2">&quot;pos&quot;</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">Variable</span><span class="p">(</span>
               <span class="bp">self</span><span class="p">,</span>
               <span class="n">name</span><span class="o">=</span><span class="s2">&quot;pos&quot;</span><span class="p">,</span>
               <span class="n">description</span><span class="o">=</span><span class="s2">&quot;The 3D position of the ball [m] (height in inch as displayUnit example.&quot;</span><span class="p">,</span>
               <span class="n">causality</span><span class="o">=</span><span class="s2">&quot;output&quot;</span><span class="p">,</span>
               <span class="n">variability</span><span class="o">=</span><span class="s2">&quot;continuous&quot;</span><span class="p">,</span>
               <span class="n">initial</span><span class="o">=</span><span class="s2">&quot;exact&quot;</span><span class="p">,</span>
               <span class="n">start</span><span class="o">=</span><span class="n">start</span><span class="p">,</span>
               <span class="n">rng</span><span class="o">=</span><span class="p">((</span><span class="mi">0</span><span class="p">,</span> <span class="s2">&quot;100 m&quot;</span><span class="p">),</span> <span class="kc">None</span><span class="p">,</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="s2">&quot;10 m&quot;</span><span class="p">)),</span>
            <span class="p">)</span>
      <span class="k">elif</span> <span class="n">name</span> <span class="o">==</span> <span class="s2">&quot;speed&quot;</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">Variable</span><span class="p">(</span>
               <span class="bp">self</span><span class="p">,</span>
               <span class="n">name</span><span class="o">=</span><span class="s2">&quot;speed&quot;</span><span class="p">,</span>
               <span class="n">description</span><span class="o">=</span><span class="s2">&quot;The 3D speed of the ball, i.e. d pos / dt [m/s]&quot;</span><span class="p">,</span>
               <span class="n">causality</span><span class="o">=</span><span class="s2">&quot;output&quot;</span><span class="p">,</span>
               <span class="n">variability</span><span class="o">=</span><span class="s2">&quot;continuous&quot;</span><span class="p">,</span>
               <span class="n">initial</span><span class="o">=</span><span class="s2">&quot;exact&quot;</span><span class="p">,</span>
               <span class="n">start</span><span class="o">=</span><span class="n">start</span><span class="p">,</span>
               <span class="n">rng</span><span class="o">=</span><span class="p">((</span><span class="mi">0</span><span class="p">,</span> <span class="s2">&quot;1 m/s&quot;</span><span class="p">),</span> <span class="kc">None</span><span class="p">,</span> <span class="p">(</span><span class="s2">&quot;-100 m/s&quot;</span><span class="p">,</span> <span class="s2">&quot;100 m/s&quot;</span><span class="p">)),</span>
            <span class="p">)</span>
      <span class="k">elif</span> <span class="n">name</span> <span class="o">==</span> <span class="s2">&quot;g&quot;</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">Variable</span><span class="p">(</span>
               <span class="bp">self</span><span class="p">,</span>
               <span class="n">name</span><span class="o">=</span><span class="s2">&quot;g&quot;</span><span class="p">,</span>
               <span class="n">description</span><span class="o">=</span><span class="s2">&quot;The gravitational acceleration (absolute value).&quot;</span><span class="p">,</span>
               <span class="n">causality</span><span class="o">=</span><span class="s2">&quot;parameter&quot;</span><span class="p">,</span>
               <span class="n">variability</span><span class="o">=</span><span class="s2">&quot;fixed&quot;</span><span class="p">,</span>
               <span class="n">start</span><span class="o">=</span><span class="n">start</span><span class="p">,</span>
               <span class="n">rng</span><span class="o">=</span><span class="p">(),</span>
            <span class="p">)</span>
      <span class="k">elif</span> <span class="n">name</span> <span class="o">==</span> <span class="s2">&quot;e&quot;</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">Variable</span><span class="p">(</span>
               <span class="bp">self</span><span class="p">,</span>
               <span class="n">name</span><span class="o">=</span><span class="s2">&quot;e&quot;</span><span class="p">,</span>
               <span class="n">description</span><span class="o">=</span><span class="s2">&quot;The coefficient of restitution, i.e. |speed after| / |speed before| bounce.&quot;</span><span class="p">,</span>
               <span class="n">causality</span><span class="o">=</span><span class="s2">&quot;parameter&quot;</span><span class="p">,</span>
               <span class="n">variability</span><span class="o">=</span><span class="s2">&quot;fixed&quot;</span><span class="p">,</span>
               <span class="n">start</span><span class="o">=</span><span class="n">start</span><span class="p">,</span>
               <span class="n">rng</span><span class="o">=</span><span class="p">(),</span>
            <span class="p">)</span>
      <span class="k">elif</span> <span class="n">name</span> <span class="o">==</span> <span class="s2">&quot;p_bounce&quot;</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">Variable</span><span class="p">(</span>
               <span class="bp">self</span><span class="p">,</span>
               <span class="n">name</span><span class="o">=</span><span class="s2">&quot;p_bounce&quot;</span><span class="p">,</span>
               <span class="n">description</span><span class="o">=</span><span class="s2">&quot;The expected position of the next bounce as 3D vector&quot;</span><span class="p">,</span>
               <span class="n">causality</span><span class="o">=</span><span class="s2">&quot;output&quot;</span><span class="p">,</span>
               <span class="n">variability</span><span class="o">=</span><span class="s2">&quot;continuous&quot;</span><span class="p">,</span>
               <span class="n">start</span><span class="o">=</span><span class="n">start</span><span class="p">,</span>
               <span class="n">rng</span><span class="o">=</span><span class="p">(),</span>
            <span class="p">)</span>
</pre></div>
</div>
<p>The following might be noted:</p>
<ul class="simple">
<li><p>The interface variables are defined in a separate local method <code class="docutils literal notranslate"><span class="pre">_interface_variables</span></code>,
keeping it separate from the model code.</p></li>
<li><p>The <code class="docutils literal notranslate"><span class="pre">do_step()</span></code> method contains the essential code, describing how the ball moves through the air.
It calls the <code class="docutils literal notranslate"><span class="pre">super().do_step()</span></code> method, which is essential to link it to <code class="docutils literal notranslate"><span class="pre">Model</span></code>.
The <cite>return True</cite> statement is also essential for the working of the emerging FMU.</p></li>
<li><p>The <code class="docutils literal notranslate"><span class="pre">next_bounce()</span></code> method is a helper method.</p></li>
<li><p>In addition to the extension of <code class="docutils literal notranslate"><span class="pre">do_step()</span></code>, here also the <code class="docutils literal notranslate"><span class="pre">setup_experiment()</span></code> method is extended.
Local (non-interface) variables can thus be initialized in a convenient way.</p></li>
</ul>
<p>It should be self-evident that thorough testing of any model is necessary <strong>before</strong> translation to a FMU.
The simulation orchestration engine (e.g. OSP) used to run FMUs obfuscates error messages,
such that first stage assurance of a model should aways done using e.g. <code class="docutils literal notranslate"><span class="pre">pytest</span></code>.
The minimal code to make the FMU file package is</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">component_model.model</span> <span class="kn">import</span> <span class="n">Model</span>
<span class="kn">from</span> <span class="nn">fmpy.util</span> <span class="kn">import</span> <span class="n">fmu_info</span>

<span class="n">asBuilt</span> <span class="o">=</span> <span class="n">Model</span><span class="o">.</span><span class="n">build</span><span class="p">(</span><span class="s2">&quot;../component_model/example_models/bouncing_ball.py&quot;</span><span class="p">)</span>
<span class="n">info</span> <span class="o">=</span> <span class="n">fmu_info</span><span class="p">(</span><span class="n">asBuilt</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>  <span class="c1"># not necessary, but it lists essential properties of the FMU</span>
</pre></div>
</div>
<p>The model can then be run using <a class="reference external" href="https://pypi.org/project/FMPy/">fmpy</a></p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">fmpy</span> <span class="kn">import</span> <span class="n">plot_result</span><span class="p">,</span> <span class="n">simulate_fmu</span>

<span class="n">result</span> <span class="o">=</span> <span class="n">simulate_fmu</span><span class="p">(</span>
   <span class="s2">&quot;BouncingBall.fmu&quot;</span><span class="p">,</span>
   <span class="n">stop_time</span><span class="o">=</span><span class="mf">3.0</span><span class="p">,</span>
   <span class="n">step_size</span><span class="o">=</span><span class="mf">0.1</span><span class="p">,</span>
   <span class="n">validate</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
   <span class="n">solver</span><span class="o">=</span><span class="s2">&quot;Euler&quot;</span><span class="p">,</span>
   <span class="n">debug_logging</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
   <span class="n">logger</span><span class="o">=</span><span class="nb">print</span><span class="p">,</span>
   <span class="n">start_values</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;pos[2]&quot;</span><span class="p">:</span> <span class="mi">2</span><span class="p">},</span> <span class="c1"># optional start value settings</span>
<span class="p">)</span>
<span class="n">plot_result</span><span class="p">(</span><span class="n">result</span><span class="p">)</span>
</pre></div>
</div>
<p>Similarly, the model can be run using <a class="reference external" href="https://opensimulationplatform.com/">OSP</a>
(or rather <a class="reference external" href="https://pypi.org/project/libcosimpy/">libcosimpy</a> - OSP wrapped into Python):</p>
<div class="highlight-Python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">libcosimpy.CosimEnums</span> <span class="kn">import</span> <span class="n">CosimExecutionState</span>
<span class="kn">from</span> <span class="nn">libcosimpy.CosimExecution</span> <span class="kn">import</span> <span class="n">CosimExecution</span>
<span class="kn">from</span> <span class="nn">libcosimpy.CosimSlave</span> <span class="kn">import</span> <span class="n">CosimLocalSlave</span>

<span class="n">sim</span> <span class="o">=</span> <span class="n">CosimExecution</span><span class="o">.</span><span class="n">from_step_size</span><span class="p">(</span><span class="n">step_size</span><span class="o">=</span><span class="mf">1e7</span><span class="p">)</span>  <span class="c1"># empty execution object with fixed time step in nanos</span>
<span class="n">bb</span> <span class="o">=</span> <span class="n">CosimLocalSlave</span><span class="p">(</span><span class="n">fmu_path</span><span class="o">=</span><span class="s2">&quot;./BouncingBall.fmu&quot;</span><span class="p">,</span> <span class="n">instance_name</span><span class="o">=</span><span class="s2">&quot;bb&quot;</span><span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;SLAVE&quot;</span><span class="p">,</span> <span class="n">bb</span><span class="p">,</span> <span class="n">sim</span><span class="o">.</span><span class="n">status</span><span class="p">())</span>

<span class="n">ibb</span> <span class="o">=</span> <span class="n">sim</span><span class="o">.</span><span class="n">add_local_slave</span><span class="p">(</span><span class="n">bb</span><span class="p">)</span>
<span class="k">assert</span> <span class="n">ibb</span> <span class="o">==</span> <span class="mi">0</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;local slave number </span><span class="si">{</span><span class="n">ibb</span><span class="si">}</span><span class="s2">&quot;</span>

<span class="n">reference_dict</span> <span class="o">=</span> <span class="p">{</span><span class="n">var_ref</span><span class="o">.</span><span class="n">name</span><span class="o">.</span><span class="n">decode</span><span class="p">():</span> <span class="n">var_ref</span><span class="o">.</span><span class="n">reference</span> <span class="k">for</span> <span class="n">var_ref</span> <span class="ow">in</span> <span class="n">sim</span><span class="o">.</span><span class="n">slave_variables</span><span class="p">(</span><span class="n">ibb</span><span class="p">)}</span>

<span class="n">sim</span><span class="o">.</span><span class="n">real_initial_value</span><span class="p">(</span><span class="n">ibb</span><span class="p">,</span> <span class="n">reference_dict</span><span class="p">[</span><span class="s2">&quot;pos[2]&quot;</span><span class="p">],</span> <span class="mf">2.0</span><span class="p">)</span>  <span class="c1"># Set initial values</span>

<span class="n">sim_status</span> <span class="o">=</span> <span class="n">sim</span><span class="o">.</span><span class="n">status</span><span class="p">()</span>
<span class="k">assert</span> <span class="n">sim_status</span><span class="o">.</span><span class="n">current_time</span> <span class="o">==</span> <span class="mi">0</span>
<span class="k">assert</span> <span class="n">CosimExecutionState</span><span class="p">(</span><span class="n">sim_status</span><span class="o">.</span><span class="n">state</span><span class="p">)</span> <span class="o">==</span> <span class="n">CosimExecutionState</span><span class="o">.</span><span class="n">STOPPED</span>
<span class="n">infos</span> <span class="o">=</span> <span class="n">sim</span><span class="o">.</span><span class="n">slave_infos</span><span class="p">()</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;INFOS&quot;</span><span class="p">,</span> <span class="n">infos</span><span class="p">)</span>

<span class="n">sim</span><span class="o">.</span><span class="n">simulate_until</span><span class="p">(</span><span class="n">target_time</span><span class="o">=</span><span class="mf">3e9</span><span class="p">)</span>  <span class="c1"># Simulate for 1 second</span>
</pre></div>
</div>
<p>This is admittedly more complex than the <code class="docutils literal notranslate"><span class="pre">fmpy</span></code> example,
but it should be emphasised that fmpy is made for single component model simulation (testing),
while OSP is made for multi-component systems.</p>
</section>
<section id="development-setup">
<h2>Development Setup<a class="headerlink" href="#development-setup" title="Link to this heading">¶</a></h2>
<section id="install-uv">
<h3>1. Install uv<a class="headerlink" href="#install-uv" title="Link to this heading">¶</a></h3>
<p>This project uses <cite>uv</cite> as package manager.</p>
<p>If you haven’t already, install <a class="reference external" href="https://docs.astral.sh/uv/">uv</a>, preferably using it’s <a class="reference external" href="https://docs.astral.sh/uv/getting-started/installation/#__tabbed_1_2/">“Standalone installer”</a> method:</p>
<p>..on Windows:</p>
<p><code class="docutils literal notranslate"><span class="pre">powershell</span> <span class="pre">-ExecutionPolicy</span> <span class="pre">ByPass</span> <span class="pre">-c</span> <span class="pre">&quot;irm</span> <span class="pre">https://astral.sh/uv/install.ps1</span> <span class="pre">|</span> <span class="pre">iex&quot;</span></code></p>
<p>..on MacOS and Linux:</p>
<p><code class="docutils literal notranslate"><span class="pre">curl</span> <span class="pre">-LsSf</span> <span class="pre">https://astral.sh/uv/install.sh</span> <span class="pre">|</span> <span class="pre">sh</span></code></p>
<p>(see <a class="reference external" href="https://docs.astral.sh/uv/getting-started/installation//">docs.astral.sh/uv</a> for all / alternative installation methods.)</p>
<p>Once installed, you can update <cite>uv</cite> to its latest version, anytime, by running:</p>
<p><code class="docutils literal notranslate"><span class="pre">uv</span> <span class="pre">self</span> <span class="pre">update</span></code></p>
</section>
<section id="install-python">
<h3>2. Install Python<a class="headerlink" href="#install-python" title="Link to this heading">¶</a></h3>
<p>This project requires Python 3.10 or later.</p>
<p>If you don’t already have a compatible version installed on your machine, the probably most comfortable way to install Python is through <code class="docutils literal notranslate"><span class="pre">uv</span></code>:</p>
<p><code class="docutils literal notranslate"><span class="pre">uv</span> <span class="pre">python</span> <span class="pre">install</span></code></p>
<p>This will install the latest stable version of Python into the uv Python directory, i.e. as a uv-managed version of Python.</p>
<p>Alternatively, and if you want a standalone version of Python on your machine, you can install Python either via <code class="docutils literal notranslate"><span class="pre">winget</span></code>:</p>
<p><code class="docutils literal notranslate"><span class="pre">winget</span> <span class="pre">install</span> <span class="pre">--id</span> <span class="pre">Python.Python</span></code></p>
<p>or you can download and install Python from the <a class="reference external" href="https://www.python.org/downloads//">python.org</a> website.</p>
</section>
<section id="clone-the-repository">
<h3>3. Clone the repository<a class="headerlink" href="#clone-the-repository" title="Link to this heading">¶</a></h3>
<p>Clone the component-model repository into your local development directory:</p>
<p><code class="docutils literal notranslate"><span class="pre">git</span> <span class="pre">clone</span> <span class="pre">https://github.com/dnv-opensource/component-model</span> <span class="pre">path/to/your/dev/component-model</span></code></p>
</section>
<section id="install-dependencies">
<h3>4. Install dependencies<a class="headerlink" href="#install-dependencies" title="Link to this heading">¶</a></h3>
<p>Run <code class="docutils literal notranslate"><span class="pre">uv</span> <span class="pre">sync</span></code> to create a virtual environment and install all project dependencies into it:</p>
<p><code class="docutils literal notranslate"><span class="pre">uv</span> <span class="pre">sync</span></code></p>
</section>
<section id="optional-activate-the-virtual-environment">
<h3>5. (Optional) Activate the virtual environment<a class="headerlink" href="#optional-activate-the-virtual-environment" title="Link to this heading">¶</a></h3>
<p>When using <code class="docutils literal notranslate"><span class="pre">uv</span></code>, there is in almost all cases no longer a need to manually activate the virtual environment.</p>
<p><code class="docutils literal notranslate"><span class="pre">uv</span></code> will find the <code class="docutils literal notranslate"><span class="pre">.venv</span></code> virtual environment in the working directory or any parent directory, and activate it on the fly whenever you run a command via <cite>uv</cite> inside your project folder structure:</p>
<p><code class="docutils literal notranslate"><span class="pre">uv</span> <span class="pre">run</span> <span class="pre">&lt;command&gt;</span></code></p>
<p>However, you still <em>can</em> manually activate the virtual environment if needed.
When developing in an IDE, for instance, this can in some cases be necessary depending on your IDE settings.
To manually activate the virtual environment, run one of the “known” legacy commands:</p>
<p>..on Windows:</p>
<p><code class="docutils literal notranslate"><span class="pre">.venv\Scripts\activate.bat</span></code></p>
<p>..on Linux:</p>
<p><code class="docutils literal notranslate"><span class="pre">source</span> <span class="pre">.venv/bin/activate</span></code></p>
</section>
<section id="install-pre-commit-hooks">
<h3>6. Install pre-commit hooks<a class="headerlink" href="#install-pre-commit-hooks" title="Link to this heading">¶</a></h3>
<p>The <code class="docutils literal notranslate"><span class="pre">.pre-commit-config.yaml</span></code> file in the project root directory contains a configuration for pre-commit hooks.
To install the pre-commit hooks defined therein in your local git repository, run:</p>
<p><code class="docutils literal notranslate"><span class="pre">uv</span> <span class="pre">run</span> <span class="pre">pre-commit</span> <span class="pre">install</span></code></p>
<p>All pre-commit hooks configured in <code class="docutils literal notranslate"><span class="pre">.pre-commit-config.yam</span></code> will now run each time you commit changes.</p>
</section>
<section id="test-that-the-installation-works">
<h3>7. Test that the installation works<a class="headerlink" href="#test-that-the-installation-works" title="Link to this heading">¶</a></h3>
<p>To test that the installation works, run pytest in the project root folder:</p>
<p><code class="docutils literal notranslate"><span class="pre">uv</span> <span class="pre">run</span> <span class="pre">pytest</span></code></p>
</section>
</section>
<section id="meta">
<h2>Meta<a class="headerlink" href="#meta" title="Link to this heading">¶</a></h2>
<p>Copyright (c) 2024 <a class="reference external" href="https://www.dnv.com/">DNV</a> AS. All rights reserved.</p>
<p>Siegfried Eisinger - <a class="reference external" href="mailto:siegfried&#46;eisinger&#37;&#52;&#48;dnv&#46;com">siegfried<span>&#46;</span>eisinger<span>&#64;</span>dnv<span>&#46;</span>com</a></p>
<p>Distributed under the MIT license. See <a class="reference external" href="LICENSE.md/">LICENSE</a> for more information.</p>
<p><a class="reference external" href="https://github.com/dnv-opensource/component-model/">https://github.com/dnv-opensource/component-model</a></p>
</section>
<section id="contribute">
<h2>Contribute<a class="headerlink" href="#contribute" title="Link to this heading">¶</a></h2>
<p>Anybody in the FMU and OSP community is welcome to contribute to this code, to make it better,
and especially including other features from model assurance,
as we firmly believe that trust in our models is needed
if we want to base critical decisions on the support from these models.</p>
<p>To contribute, follow these steps:</p>
<ol class="arabic simple">
<li><p>Fork it <a class="reference external" href="https://github.com/dnv-opensource/component-model/fork/">https://github.com/dnv-opensource/component-model/fork/</a></p></li>
<li><p>Create an issue in your GitHub repo</p></li>
<li><p>Create your branch based on the issue number and type (<code class="docutils literal notranslate"><span class="pre">git</span> <span class="pre">checkout</span> <span class="pre">-b</span> <span class="pre">issue-name</span></code>)</p></li>
<li><p>Evaluate and stage the changes you want to commit (<code class="docutils literal notranslate"><span class="pre">git</span> <span class="pre">add</span> <span class="pre">-i</span></code>)</p></li>
<li><p>Commit your changes (<code class="docutils literal notranslate"><span class="pre">git</span> <span class="pre">commit</span> <span class="pre">-am</span> <span class="pre">'place</span> <span class="pre">a</span> <span class="pre">descriptive</span> <span class="pre">commit</span> <span class="pre">message</span> <span class="pre">here'</span></code>)</p></li>
<li><p>Push to the branch (<code class="docutils literal notranslate"><span class="pre">git</span> <span class="pre">push</span> <span class="pre">origin</span> <span class="pre">issue-name</span></code>)</p></li>
<li><p>Create a new Pull Request in GitHub</p></li>
</ol>
<p>For your contribution, please make sure you follow the <a class="reference external" href="STYLEGUIDE.md/">STYLEGUIDE</a> before creating the Pull Request.</p>
</section>
</section>

        </article>
      </div>
      <footer>
        
        <div class="related-pages">
          <a class="next-page" href="CHANGELOG.html">
              <div class="page-info">
                <div class="context">
                  <span>Next</span>
                </div>
                <div class="title">Changelog</div>
              </div>
              <svg class="furo-related-icon"><use href="#svg-arrow-right"></use></svg>
            </a>
          <a class="prev-page" href="index.html">
              <svg class="furo-related-icon"><use href="#svg-arrow-right"></use></svg>
              <div class="page-info">
                <div class="context">
                  <span>Previous</span>
                </div>
                
                <div class="title">Home</div>
                
              </div>
            </a>
        </div>
        <div class="bottom-of-page">
          <div class="left-details">
            <div class="copyright">
                Copyright &#169; 2024, DNV AS. All rights reserved.
            </div>
            Made with <a href="https://www.sphinx-doc.org/">Sphinx</a> and <a class="muted-link" href="https://pradyunsg.me">@pradyunsg</a>'s
            
            <a href="https://github.com/pradyunsg/furo">Furo</a>
            
          </div>
          <div class="right-details">
            
          </div>
        </div>
        
      </footer>
    </div>
    <aside class="toc-drawer">
      
      
      <div class="toc-sticky toc-scroll">
        <div class="toc-title-container">
          <span class="toc-title">
            On this page
          </span>
        </div>
        <div class="toc-tree-container">
          <div class="toc-tree">
            <ul>
<li><a class="reference internal" href="#">Introduction</a><ul>
<li><a class="reference internal" href="#installation">Installation</a></li>
<li><a class="reference internal" href="#getting-started">Getting Started</a></li>
<li><a class="reference internal" href="#usage-example">Usage example</a></li>
<li><a class="reference internal" href="#development-setup">Development Setup</a><ul>
<li><a class="reference internal" href="#install-uv">1. Install uv</a></li>
<li><a class="reference internal" href="#install-python">2. Install Python</a></li>
<li><a class="reference internal" href="#clone-the-repository">3. Clone the repository</a></li>
<li><a class="reference internal" href="#install-dependencies">4. Install dependencies</a></li>
<li><a class="reference internal" href="#optional-activate-the-virtual-environment">5. (Optional) Activate the virtual environment</a></li>
<li><a class="reference internal" href="#install-pre-commit-hooks">6. Install pre-commit hooks</a></li>
<li><a class="reference internal" href="#test-that-the-installation-works">7. Test that the installation works</a></li>
</ul>
</li>
<li><a class="reference internal" href="#meta">Meta</a></li>
<li><a class="reference internal" href="#contribute">Contribute</a></li>
</ul>
</li>
</ul>

          </div>
        </div>
      </div>
      
      
    </aside>
  </div>
</div><script src="_static/documentation_options.js?v=01f34227"></script>
    <script src="_static/doctools.js?v=9bcbadda"></script>
    <script src="_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="_static/scripts/furo.js?v=5fa4622c"></script>
    </body>
</html>